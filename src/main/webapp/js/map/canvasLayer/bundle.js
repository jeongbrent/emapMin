(()=>{"use strict";function t(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}var e="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},r={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},n={};n[r.DEGREES]=2*Math.PI*6370997/360,n[r.FEET]=.3048,n[r.METERS]=1,n[r.USFEET]=1200/3937;const o=r;var a=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};a.prototype.canWrapX=function(){return this.canWrapX_},a.prototype.getCode=function(){return this.code_},a.prototype.getExtent=function(){return this.extent_},a.prototype.getUnits=function(){return this.units_},a.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||n[this.units_]},a.prototype.getWorldExtent=function(){return this.worldExtent_},a.prototype.getAxisOrientation=function(){return this.axisOrientation_},a.prototype.isGlobal=function(){return this.global_},a.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},a.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},a.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},a.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},a.prototype.setWorldExtent=function(t){this.worldExtent_=t},a.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},a.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};const i=a;var s=6378137,l=Math.PI*s,c=[-l,-l,l,l],u=[-180,-85,180,85],p=function(t){function r(r){t.call(this,{code:r,units:o.METERS,extent:c,global:!0,worldExtent:u,getPointResolution:function(t,r){return t/e(r[1]/s)}})}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r}(i),h=[new p("EPSG:3857"),new p("EPSG:102100"),new p("EPSG:102113"),new p("EPSG:900913"),new p("urn:ogc:def:crs:EPSG:6.18:3:3857"),new p("urn:ogc:def:crs:EPSG::3857"),new p("http://www.opengis.net/gml/srs/epsg.xml#3857")];var d,m,f,g=[-180,-90,180,90],y=6378137*Math.PI/180,v=function(t){function e(e,r){t.call(this,{code:e,units:o.DEGREES,extent:g,axisOrientation:r,global:!0,metersPerUnit:y,worldExtent:g})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(i),_=[new v("CRS:84"),new v("EPSG:4326","neu"),new v("urn:ogc:def:crs:EPSG::4326","neu"),new v("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new v("urn:ogc:def:crs:OGC:1.3:CRS84"),new v("urn:ogc:def:crs:OGC:2:84"),new v("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new v("urn:x-ogc:def:crs:EPSG:4326","neu")],w={},P={};function S(t,e,r){var n=t.getCode(),o=e.getCode();n in P||(P[n]={}),P[n][o]=r}function E(t,e,r){var n;if(void 0!==e){for(var o=0,a=t.length;o<a;++o)e[o]=t[o];n=e}else n=t.slice();return n}function x(t,e,r){if(void 0!==e&&t!==e){for(var n=0,o=t.length;n<o;++n)e[n]=t[n];t=e}return t}function L(t){!function(t,e){w[t]=e}(t.getCode(),t),S(t,t,E)}function b(t){return"string"==typeof t?w[t]||null:t||null}function I(t){!function(t){t.forEach(L)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&S(e,t,E)}))}))}function R(t,e){return function(t,e,r){return function(t,e){return r=b(t),n=b(e),o=function(t,e){var r;return t in P&&e in P[t]&&(r=P[t][e]),r}(r.getCode(),n.getCode()),o||(o=x),o;var r,n,o}(e,r)(t,void 0,t.length)}(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function T(t,e,r){const[n,o]=e,a=Math.floor(n),i=Math.floor(o),s=Math.ceil(n),l=Math.ceil(o),c=n-a,u=o-i,p=r[s+t*i],h=r[a+t*i],d=r[a+t*l];return(p-h)*c+(d-h)*u+(h+r[s+t*l]-p-d)*c*u+h}I(h),I(_),d=h,m=function(t,e,r){var n=t.length,o=r>1?r:2,a=e;void 0===a&&(a=o>2?t.slice():new Array(n));for(var i=l,c=0;c<n;c+=o){a[c]=i*t[c]/180;var u=s*Math.log(Math.tan(Math.PI*(t[c+1]+90)/360));u>i?u=i:u<-i&&(u=-i),a[c+1]=u}return a},f=function(t,e,r){var n=t.length,o=r>1?r:2,a=e;void 0===a&&(a=o>2?t.slice():new Array(n));for(var i=0;i<n;i+=o)a[i]=180*t[i]/l,a[i+1]=360*Math.atan(Math.exp(t[i+1]/s))/Math.PI-90;return a},_.forEach((function(t){d.forEach((function(e){S(t,e,m),S(e,t,f)}))}));class F{constructor(t,e,r,n,o){this.extent=function(t,e){return t.slice()}(o),this.dataWidth_=r,this.dataHeight_=n,this.speedBuffer_=new Float32Array(t.length),this.simpleSpeedBuffer=new Uint8Array(t.length),this.rotationBuffer_=new Float32Array(t.length),this.uBuffer_=t,this.vBuffer_=e;for(let r=0;r<t.length;++r){const n=t[r],o=e[r],a=Math.sqrt(n*n+o*o),i=Math.atan2(o,n);this.speedBuffer_[r]=a,this.simpleSpeedBuffer[r]=Math.ceil(a),this.rotationBuffer_[r]=i}}getUVSpeed(t){const e=this.dataWidth_,r=this.dataHeight_,n=function(t,e,r,n){return[(n[0]-t[0])/(t[2]-t[0])*(e-1),(Math.atan(Math.sinh(n[1]/6378137))*(180/Math.PI)+90)/180*(r-1)]}(this.extent,e,r,t);return[T(e,n,this.uBuffer_),T(e,n,this.vBuffer_)]}getRotation(t){return this.rotationBuffer_[t]}getSpeed(t){return this.speedBuffer_[t]}}var C="function"==typeof Object.assign?Object.assign:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1,a=arguments.length;o<a;++o){var i=r[o];if(null!=i)for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])}return n};function M(t){for(var e in t)delete t[e]}function k(t,e,r,n){for(var o,a=0,i=t.length;a<i;++a)if((o=t[a]).listener===e&&o.bindTo===r)return n&&(o.deleteIndex=a),o}function B(t,e){var r=O(t);return r?r[e]:void 0}function O(t,e){var r=t.ol_lm;return!r&&e&&(r=t.ol_lm={}),r}function A(t,e){var r=B(t,e);if(r){for(var n=0,o=r.length;n<o;++n)t.removeEventListener(e,r[n].boundListener),M(r[n]);r.length=0;var a=O(t);a&&(delete a[e],0===Object.keys(a).length&&function(t){delete t.ol_lm}(t))}}function z(t,e,r,n,o){var a=O(t,!0),i=a[e];i||(i=a[e]=[]);var s=k(i,r,n,!1);return s?o||(s.callOnce=!1):(s={bindTo:n,callOnce:!!o,listener:r,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&Z(t),r.call(n,e)};return t.boundListener=e,e}(s)),i.push(s)),s}function G(t,e,r,n){return z(t,e,r,n,!0)}function D(t,e,r,n){var o=B(t,e);if(o){var a=k(o,r,n,!0);a&&Z(a)}}function Z(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=B(t.target,t.type);if(e){var r="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==r&&e.splice(r,1),0===e.length&&A(t.target,t.type)}M(t)}}const W="change";function N(){return function(){throw new Error("Unimplemented abstract method.")}()}var X=0;function j(t){return t.ol_uid||(t.ol_uid=String(++X))}var V=function(){this.disposed_=!1};V.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},V.prototype.disposeInternal=function(){};const U=V;function Y(){}var K=function(t){this.propagationStopped,this.type=t,this.target=null};K.prototype.preventDefault=function(){this.propagationStopped=!0},K.prototype.stopPropagation=function(){this.propagationStopped=!0};const q=K;var H=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new q(t):t,r=e.type;e.target=this;var n,o=this.listeners_[r];if(o){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var a=0,i=o.length;a<i;++a)if(!1===o[a].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,Y);delete this.dispatching_[r]}return n}},e.prototype.disposeInternal=function(){!function(t){var e=O(t);if(e)for(var r in e)A(t,r)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var r=this.listeners_[t];if(r){var n=r.indexOf(e);t in this.pendingRemovals_?(r[n]=Y,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t])}},e}(U);const $=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(W)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=z(this,t[o],e);return n}return z(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=G(this,t[o],e);return n}return G(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)D(this,t[r],e);else D(this,t,e)},e}(H);var J=function(t){function e(e,r,n){t.call(this,e),this.key=r,this.oldValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(q),Q={};function tt(t){return Q.hasOwnProperty(t)?Q[t]:Q[t]="change:"+t}const et="opacity",rt="visible",nt="extent",ot="zIndex",at="maxResolution",it="minResolution",st="source";var lt=function(t){function e(e){t.call(this);var r=C({},e);r[et]=void 0!==e.opacity?e.opacity:1,r[rt]=void 0===e.visible||e.visible,r[ot]=e.zIndex,r[at]=void 0!==e.maxResolution?e.maxResolution:1/0,r[it]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(r),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t,e=this.state_||{layer:this,managed:!0};return e.opacity=(t=this.getOpacity(),0,1,Math.min(Math.max(t,0),1)),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=this.getZIndex()||0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),this.state_=e,e},e.prototype.getLayersArray=function(t){return N()},e.prototype.getLayerStatesArray=function(t){return N()},e.prototype.getExtent=function(){return this.get(nt)},e.prototype.getMaxResolution=function(){return this.get(at)},e.prototype.getMinResolution=function(){return this.get(it)},e.prototype.getOpacity=function(){return this.get(et)},e.prototype.getSourceState=function(){return N()},e.prototype.getVisible=function(){return this.get(rt)},e.prototype.getZIndex=function(){return this.get(ot)},e.prototype.setExtent=function(t){this.set(nt,t)},e.prototype.setMaxResolution=function(t){this.set(at,t)},e.prototype.setMinResolution=function(t){this.set(it,t)},e.prototype.setOpacity=function(t){this.set(et,t)},e.prototype.setVisible=function(t){this.set(rt,t)},e.prototype.setZIndex=function(t){this.set(ot,t)},e}(function(t){function e(e){t.call(this),j(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return C({},this.values_)},e.prototype.notify=function(t,e){var r;r=tt(t),this.dispatchEvent(new J(r,t,e)),r="propertychange",this.dispatchEvent(new J(r,t,e))},e.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e}($));var ct=function(t){function e(e){var r=C({},e);delete r.source,t.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),z(this,tt(st),this.handleSourcePropertyChange_,this);var n=e.source?e.source:null;this.setSource(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(st)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(Z(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=z(t,W,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(Z(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Z(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=z(t,"precompose",(function(t){var e=t,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),e.frameState.layerStatesArray.push(r),e.frameState.layerStates[j(this)]=r}),this),this.mapRenderKey_=z(this,W,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(st,t)},e}(lt);const ut=ct;function pt(t,e){let[r,n]=t.size;if(r*=t.pixelRatio,n*=t.pixelRatio,e.width!==r||e.height!==n)return e.width=r,e.height=n,!0}function ht(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}new Array(6);const dt=[];class mt extends ${constructor(t){super(),this.layer=t,this.canvases_=[document.createElement("canvas"),document.createElement("canvas")],this.previousFrame_={canvasId:0,centerX:0,centerY:0,resolution:1/0}}static handles(t){return t instanceof ft}static create(t,e){return new mt(e)}prepareFrame(t){const e=this.layer,r=this.canvases_[this.previousFrame_.canvasId];let n=r;const o=pt(t,r);let a=this.previousFrame_.canvasId;const[i,s]=t.viewState.center,l=t.viewState.resolution;if(!o&&this.previousFrame_.resolution===l){dt[0]=this.previousFrame_.centerX,dt[1]=this.previousFrame_.centerY,ht(t.coordinateToPixelTransform,dt);const e=dt[0]-t.size[0]/2,o=dt[1]-t.size[1]/2;if(0!==e||0!==o){a=(a+1)%2,n=this.canvases_[a],pt(t,n);const i=n.getContext("2d");i.clearRect(0,0,n.width,n.height),i.drawImage(r,e,o)}}this.previousFrame_.canvasId=a,this.previousFrame_.centerX=i,this.previousFrame_.centerY=s,this.previousFrame_.resolution=l;const c=n.getContext("2d");return e.doRender_(t,c),t.animate=!0,!0}composeFrame(t,e,r){const n=this.canvases_[this.previousFrame_.canvasId],o=n.width,a=n.height;r.drawImage(n,0,0,o,a)}}class ft extends ut{constructor(t){super({}),this.doRender_=t.renderFunction}getSourceState(){return"ready"}}function gt(t,e){var r,n;e[0]=Math.random()*function(t){return t[2]-t[0]}(t)+t[0],e[1]=(r=Math.random(),n=Math.PI*(r-.5),Math.log(Math.tan(Math.PI/4+n/2))/Math.PI*20037508.34)}class yt extends ft{constructor(t){super({renderFunction:(e,r)=>{let n;return n=t.uvBuffer1?"dimgray":4==t.brightMode?"#777777":"white",this.render(e,r,n)}}),this.fading=t.fading||.8,console.assert(t.ttl),this.ttl=t.ttl,console.assert(t.map),this.map=t.map,console.assert(t.particleSize1),console.assert(t.particleSize2),this.particleSize1=t.particleSize1,this.particleSize2=t.particleSize2;const e=[t.uvBuffer1,t.uvBuffer2,t.uvBuffer3];for(const t of e)if(t){console.assert(t),this.uvBuffer=t;break}console.assert(t.particles),this.particles=new Array(t.particles);for(let e=0;e<t.particles;++e)this.particles[e]={ttl:Math.random()*this.ttl,coordinates:[]};this.pixel=[],this.viewportWithDataExtent=[1/0,1/0,-1/0,-1/0],this.map.getRenderer().registerLayerRenderers([mt])}render(t,e,r){const n=e.canvas;e.fillStyle=r,this.advanceParticles(t,e),e.globalAlpha=this.fading,e.globalCompositeOperation="destination-in",e.fillRect(0,0,n.width,n.height),e.globalAlpha=1,e.globalCompositeOperation="source-over"}advanceParticles(t,e){if(n=this.uvBuffer.extent,o=t.extent,a=this.viewportWithDataExtent,i=a||[1/0,1/0,-1/0,-1/0],function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(n,o)?(n[0]>o[0]?i[0]=n[0]:i[0]=o[0],n[1]>o[1]?i[1]=n[1]:i[1]=o[1],n[2]<o[2]?i[2]=n[2]:i[2]=o[2],n[3]<o[3]?i[3]=n[3]:i[3]=o[3]):function(t){!function(t,e,r,n,o){o&&(o[0]=t,o[1]=e,o[2]=r,o[3]=n)}(1/0,1/0,-1/0,-1/0,t)}(i),(r=this.viewportWithDataExtent)[2]<r[0]||r[3]<r[1])return;var r,n,o,a,i;const s=this.pixel,l=t.viewState.resolution,c=t.pixelRatio;this.particles.forEach((r=>{var n;0!==r.coordinates.length&&function(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}(this.viewportWithDataExtent,(n=r.coordinates)[0],n[1])||gt(this.viewportWithDataExtent,r.coordinates),s[0]=r.coordinates[0],s[1]=r.coordinates[1];const[o,a]=this.uvBuffer.getUVSpeed(r.coordinates);if(0!==o&&0!==a){ht(t.coordinateToPixelTransform,s);const n=function(t,e){return Math.atan2(t,e)*(180/Math.PI)}(o,a);e.save(),e.translate(s[0]*c,s[1]*c),e.rotate(n*Math.PI/180),r.ttl>this.ttl/2?e.globalAlpha=2*(1-r.ttl/this.ttl):e.globalAlpha=r.ttl/this.ttl*2,e.fillRect(-this.particleSize1*c/2,-this.particleSize2*c/2,this.particleSize1*c,this.particleSize2*c),e.restore()}--r.ttl,r.ttl<0&&(gt(this.viewportWithDataExtent,r.coordinates),r.ttl=this.ttl),r.coordinates[0]+=o*l,r.coordinates[1]+=a*l}))}}let vt,_t,wt=.5,Pt=4;const St="/{z}/{x}/{-y}.png";let Et,xt,Lt,bt,It,Rt,Tt,Ft,Ct,Mt,kt,Bt,Ot,At,zt,Gt,Dt,Zt,Wt,Nt=1,Xt=1,jt=new Date;var Vt,Ut,Yt,Kt,qt;function Ht(){$t(!0),document.getElementById("weatherTime").innerText=ne(jt),zt||Gt||Dt?se(!1):(Zt||Wt)&&se(!0)}function $t(t){if(4!=Nt&&(map.removeLayer(_t),_t=null),zt)t||(zt=!1),map.removeLayer(Mt),Mt=null;else if(Gt)t||(Gt=!1),map.removeLayer(kt),kt=null;else if(Dt)t||(Dt=!1),map.removeLayer(Bt),Bt=null;else if((Zt||Wt)&&(Zt?(t||(Zt=!1),map.removeLayer(Ot),Ot=null):Wt&&(t||(Wt=!1),map.removeLayer(At),At=null),!t)){const t=document.querySelector("#tempLegend");t&&t.remove()}}function Jt(){const t=document.createElement("div");t.id="tempLegend",t.style.position="absolute",t.style.top="30px",t.style.right="0px",t.style.width="45px",t.style.height="162px",t.style.backgroundImage="url(images/emap/legend_temp.png)",t.style.opacity="1",document.body.appendChild(t)}function Qt(){1==Nt?1==Xt?(ce(),Et.setZIndex(-1)):2==Xt?(xt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Standard"+St})}),map.addLayer(xt),xt.setZIndex(-1)):(Lt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Full"+St})}),map.addLayer(Lt),Lt.setZIndex(-1)):2==Nt?1==Xt?(bt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Base"+St})}),map.addLayer(bt),bt.setZIndex(-1)):2==Xt?(It=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Standard"+St})}),map.addLayer(It),It.setZIndex(-1)):(Rt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Full"+St})}),map.addLayer(Rt),Rt.setZIndex(-1)):3==Nt&&(1==Xt?(Tt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Base"+St})}),map.addLayer(Tt),Tt.setZIndex(-1)):2==Xt?(Ft=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Standard"+St})}),map.addLayer(Ft),Ft.setZIndex(-1)):(Ct=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Full"+St})}),map.addLayer(Ct),Ct.setZIndex(-1)))}function te(){wt=0===Pt?1:.5}let ee;function re(t){let e,r;switch(console.log("lev : "+Pt),Pt){case 0:case 1:e=4,r=23;break;case 2:e=8,r=23;break;case 3:e=6,r=35;break;case 4:e=10,r=55;break;case 5:e=10,r=75;break;case 6:e=15,r=115;break;case 7:e=18,r=155;break;case 8:e=23,r=155;break;case 9:e=35,r=155;break;default:e=2e3,r=155}console.log("radius : "+e),t.setRadius(e),t.setBlur(r),t.changed()}function ne(t){let e=t.getFullYear(),r=t.getMonth()+1,n=t.getDate();r=r<10?"0"+r:r,n=n<10?"0"+n:n;let o=t.getHours();return o=3*parseInt(o/3)+"시",o=o<10?"0"+o:o,e+"-"+r+"-"+n+" "+o}function oe(t){jt.setHours(jt.getHours()+t)}var ae;ce(),Vt=document.getElementById("checkWind"),Ut=document.getElementById("checkFlow"),Yt=document.getElementById("checkWave"),Kt=document.getElementById("checkTempair"),qt=document.getElementById("checkTempwater"),Vt.addEventListener("change",(function(){Vt.checked&&($t(!1),zt=!0,se(!1))})),Ut.addEventListener("change",(function(){Ut.checked&&($t(!1),Gt=!0,se(!1))})),Yt.addEventListener("change",(function(){Yt.checked&&($t(!1),Dt=!0,se(!1))})),Kt.addEventListener("change",(function(){Kt.checked&&($t(!1),Zt=!0,se(!0),Jt())})),qt.addEventListener("change",(function(){qt.checked&&($t(!1),Wt=!0,se(!0),Jt())})),(ae=document.getElementById("brightSelect")).addEventListener("change",(function(){const t=[Et,bt,Tt],e=[xt,It,Ft],r=[Lt,Rt,Ct];let n=map.getLayers().getArray();const o=t=>{n.includes(t)&&(map.removeLayer(t),t=null)};t.forEach(o),e.forEach(o),r.forEach(o),map.removeLayer(vt),vt=null,map.removeLayer(_t),_t=null;var a=ae.value;Nt=a,4==Nt?(vt=new ol.layer.Tile({id:"ocean",title:"ocean",opacity:1,source:new ol.source.TileWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.1.0",LAYERS:"emap:ocean",CRS:"EPSG:3857"}})}),map.addLayer(vt),vt.setZIndex(-1),pe("ocean","Polygon1_1","17284F",null),le(),map.addLayer(_t),_t.setZIndex(1),pe("worldcountries","Polygon1_2","1E1E1E","6689CA")):Qt(),4!=Nt&&(Gt||Dt||Wt)&&ue()})),document.getElementById("modeSelect").addEventListener("change",(function(){const t=[Et,bt,Tt],e=[xt,It,Ft],r=[Lt,Rt,Ct];let n=map.getLayers().getArray();const o=t=>{n.includes(t)&&(map.removeLayer(t),t=null)};t.forEach(o),e.forEach(o),r.forEach(o);var a=event.target.value;"1"===a?Xt=1:"2"===a?Xt=2:"3"===a&&(Xt=3),Qt()})),map.on("movestart",(function(){4!=Nt&&(map.removeLayer(_t),_t=null),zt?(map.removeLayer(Mt),Mt=null):Gt?(map.removeLayer(kt),kt=null):Dt?(map.removeLayer(Bt),Bt=null):Zt?(map.removeLayer(Ot),Ot=null):Wt&&(map.removeLayer(At),At=null)})),map.on("moveend",(function(){te(),zt||Gt||Dt?(zt?(map.removeLayer(Mt),Mt=null):Gt?(map.removeLayer(kt),kt=null):Dt&&(map.removeLayer(Bt),Bt=null),se(!1)):(Zt||Wt)&&(Zt?(map.removeLayer(Ot),Ot=null):Wt&&(map.removeLayer(At),At=null),se(!0))})),map.getView().on("change:resolution",(function(){Pt=map.getView().getZoom(),clearTimeout(ee),ee=setTimeout((function(){Number.isInteger(Pt)&&te()}),250)})),function(){let t=null;document.querySelectorAll(".customRadio").forEach((function(e){e.addEventListener("click",(function(){this===t?(this.checked=!1,t=null,$t(!1)):t=this}))}))}(),document.getElementById("weatherTime").innerText=ne(jt),document.getElementById("timeMinus12").addEventListener("click",(function(){oe(-12),Ht()})),document.getElementById("timeMinus3").addEventListener("click",(function(){oe(-3),Ht()})),document.getElementById("timeNow").addEventListener("click",(function(){jt=new Date,Ht()})),document.getElementById("timePlus3").addEventListener("click",(function(){oe(3),Ht()})),document.getElementById("timePlus12").addEventListener("click",(function(){oe(12),Ht()})),dateInput=document.getElementById("selectDate"),dateInput.addEventListener("change",(function(t){let e=new Date(t.target.value);jt=e,Ht()}));let ie=null;function se(e){let r=ne(jt);let n,o,a,i=[1/0,1/0,-1/0,-1/0];!async function(r){ie&&ie.abort(),ie=new AbortController;const{signal:s}=ie;let l,c=map.getView().calculateExtent(map.getSize()),u=ol.proj.transform(ol.extent.getBottomLeft(c),"EPSG:3857","EPSG:4326"),p=ol.proj.transform(ol.extent.getTopRight(c),"EPSG:3857","EPSG:4326"),h=90,d=u[0],m=p[0];e&&(h=p[1]+wt,d-=wt);let f=r.slice(0,10).replace(/-/g,""),g=r.slice(11,13);g.endsWith("시")&&(g=g.charAt(0));let y=0;e&&(y=1);let v=`./api/weather/all?date=${f}&time=${g}&lat1=-90&lat2=${h}&lon1=${d}&lon2=${m}&degree=${wt}&data=${y}`;if(l=await fetch(v,{signal:s}),l.ok){try{a=await l.json()}catch(t){return void alert("기상 데이터를 제대로 받아오지 못했습니다.")}var _=new Set,w=new Set;a.forEach((function(t){t.hasOwnProperty("lat")&&_.add(t.lat),t.hasOwnProperty("lon")&&w.add(t.lon)})),n=w.size,o=_.size,function(){zt?(map.removeLayer(Mt),Mt=null):Gt?(map.removeLayer(kt),kt=null):Dt?(map.removeLayer(Bt),Bt=null):Ot?(map.removeLayer(Ot),Ot=null):At&&(map.removeLayer(At),At=null);const e=[],r=[];function s(t,e){return t.map((t=>t[e]))}const l=s(a,"lat"),c=s(a,"lon");let u,p,h,d,m,f,g;zt?(u=s(a,"ugrd10m"),p=s(a,"vgrd10m"),a=null):Gt?(u=s(a,"u_current"),p=s(a,"v_current"),a=null):Dt&&(u=s(a,"fwaveu"),p=s(a,"fwavev"),a=null);for(let n=0;n<l.length;n++){const o=R([parseFloat(c[n]),parseFloat(l[n])]);let a,s;zt?(a=u[n]/5,s=p[n]/5,e.push(a),r.push(s)):Gt?(a=u[n],s=p[n],e.push(a),r.push(s)):Dt&&(a=u[n]/70,s=p[n]/70,e.push(a),r.push(s)),t(i,o)}if((zt||Gt||Dt)&&(h=new Float32Array(e),d=new Float32Array(r),zt?m=new F(h,d,n,o,i):Gt?f=new F(h,d,n,o,i):g=new F(h,d,n,o,i)),zt)Mt=new yt({map,uvBuffer1:m,particles:1e4,fading:.98,ttl:400,particleSize1:1.5,particleSize2:1.5,brightMode:Nt});else if(Gt)kt=new yt({map,uvBuffer2:f,particles:2e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5,brightMode:Nt});else if(Dt)Bt=new yt({map,uvBuffer3:g,particles:1e4,fading:.45,ttl:150,particleSize1:6,particleSize2:3,brightMode:Nt});else{let t;const e=-20,r=40;if(Pt>=3&&Pt<10){let n;n=3==Pt?.6:Pt<=4?.4:Pt<=5?.15:Pt<=6?.1:Pt<=7?.07:Pt<=8?.05:Pt<=9?.04:.3;let o=[];for(let t=0;t<a.length-1;t++){const i=a[t],s=a[t+1],l=s.lat-i.lat,c=s.lon-i.lon,u=Math.max(1,Math.round(Math.abs(l)/(n/4))),p=Math.max(1,Math.round(Math.abs(c)/n));for(let t=0;t<=u;t++){const n=t/u,a=i.lat+l*n;for(let t=0;t<=p;t++){const l=t/p,u=i.lon+c*l,h=Zt?parseFloat(i.air_temp):parseFloat(i.water_temp),d=h+((Zt?parseFloat(s.air_temp):parseFloat(s.water_temp))-h)*(n+l)/2,m={lat:a,lon:u},f=Math.min(Math.max(parseFloat(d.toFixed(2)),e),r);m.weight=(f-e)/(r-e),o.push(m)}}}t=o,o=null}else{let n=[];for(let t=0;t<a.length-1;t++){const o=a[t],i=Zt?parseFloat(o.air_temp):parseFloat(o.water_temp),s={lat:o.lat,lon:o.lon},l=Math.min(Math.max(parseFloat(i.toFixed(2)),e),r);s.weight=(l-e)/(r-e),n.push(s)}t=n}a=null;const n=[];if(Pt>=10){const e=t[0];if(t=null,e){const t=map.getView().getCenter(),r=new ol.Feature({geometry:new ol.geom.Point(t),weight:e.weight});n.push(r)}else alert("기상 데이터를 제대로 받아오지 못했습니다.")}else t.map((t=>{const e=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(t.lon),parseFloat(t.lat)])),weight:t.weight});n.push(e)})),t=null;Zt?Ot=new ol.layer.Heatmap({source:new ol.source.Vector({features:n}),weight:function(t){return t.get("weight")},opacity:.3}):At=new ol.layer.Heatmap({source:new ol.source.Vector({features:n}),weight:function(t){return t.get("weight")},opacity:.5})}zt?(map.addLayer(Mt),_t.setZIndex(-1)):Gt?(map.addLayer(kt),ue()):Dt?(map.addLayer(Bt),ue()):Zt?(map.addLayer(Ot),re(Ot),_t.setZIndex(-1)):Wt&&(map.addLayer(At),re(At),ue())}()}else alert("서버 응답이 없습니다.")}(r)}function le(){_t=new ol.layer.Tile({id:"worldcountries",title:"worldcountries",opacity:1,source:new ol.source.TileWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.1.0",LAYERS:"emap:worldcountries",CRS:"EPSG:3857"}})})}function ce(){Et=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Base"+St})}),map.addLayer(Et)}function ue(){4!=Nt&&le(),1==Nt?(map.addLayer(_t),pe("worldcountries","Polygon1_2","bfbe8f","bfbe8f")):2==Nt?(map.addLayer(_t),pe("worldcountries","Polygon1_2","40402e","40402e")):3==Nt&&(map.addLayer(_t),pe("worldcountries","Polygon1_2","17160e","17160e")),_t.setZIndex(1)}function pe(t,e,r,n){var o="\t\t\t\t\t<?xml version='1.0' encoding='UTF-8'?>\t\t\t\t\t<StyledLayerDescriptor version='1.0.0' \t\t\t\t\t xsi:schemaLocation='http://www.opengis.net/sld StyledLayerDescriptor.xsd' \t\t\t\t\t xmlns='http://www.opengis.net/sld' \t\t\t\t\t xmlns:ogc='http://www.opengis.net/ogc' \t\t\t\t\t xmlns:xlink='http://www.w3.org/1999/xlink' \t\t\t\t\t xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'>\t\t\t\t\t  <NamedLayer>\t\t\t\t\t    <Name>emap:"+t+"</Name>\t\t\t\t\t    <UserStyle>\t\t\t\t\t      <Title>Default Polygon</Title>\t\t\t\t\t      <Abstract>A sample style that draws a polygon</Abstract>\t\t\t\t\t      <FeatureTypeStyle>\t\t\t\t\t        <Rule>\t\t\t\t\t";"Polygon1"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon1_1"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon1_2"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon2"==e&&(o+="\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>0</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t\t\t<Rule>\t\t\t\t\t          <Title>0to20</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t            <ogc:And>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>0</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t              <ogc:PropertyIsLessThan>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>20</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsLessThan>\t\t\t\t\t            </ogc:And>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t        <Rule>\t\t\t\t\t          <Title>20to100</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t            <ogc:And>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>20</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t              <ogc:PropertyIsLessThan>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>100</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsLessThan>\t\t\t\t\t            </ogc:And>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+n+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t        <Rule>\t\t\t\t\t          <Title>100great</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>100</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+n+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t"),o+="\t\t\t\t        </Rule>\t\t\t\t      </FeatureTypeStyle>\t\t\t\t    </UserStyle>\t\t\t\t  </NamedLayer>\t\t\t\t</StyledLayerDescriptor>\t\t\t\t",getLayer(t).getSource().updateParams({STYLES:"",SLD_BODY:o})}})();